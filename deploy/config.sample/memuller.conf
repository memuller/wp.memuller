### memuller.template.conf START


### snippets/vars.cache.aggressive.conf START
map $sent_http_content_type $mime_expiration {
default                     0;
~text/html                  180;
~text/css                   31536000;
~application/javascript     31536000;
~image/                     31536000;
~audio/                     31536000;
~video/                     31536000;
}

map $mime_expiration $mime_cache {
default     'public; ';
0           'no-cache; no-store; ';
}

map $mime_expiration $mime_immutable {
default     '';
31536000    'immutable; ';

}

map $mime_expiration $mime_revalidate {
default    '';
0          'must-revalidate; proxy-revalidate; ';
}

map $mime_cache $mime_log {
default   on;
31536000  off;
### snippets/vars.cache.aggressive.conf END
### h5bp/directive-only/cache-file-descriptors.conf START
open_file_cache          max=1000 inactive=20s;
open_file_cache_valid    30s;
open_file_cache_min_uses 2;
open_file_cache_errors   on;
### h5bp/directive-only/cache-file-descriptors.conf END

server {
listen 80 default_server ;
listen [::]:80 default_server ipv6only=on ;

server_name memuller.com
jeancatanho.com
www.memuller.com
www.jeancatanho.com ;

set $path /var/www/memuller.com/web ;
root $path ;

set $wp_content_path /app/;
set $wp_site_path /wp/;

index index.php ;

### snippets/cache.conf START
proxy_hide_header Cache-Control;
add_header Cache-Control "${mime_cache}${mime_immutable}max-age=$mime_expiration; ${mime_revalidate}";
### snippets/cache.conf END
### snippets/etag.conf START
etag on;
### snippets/etag.conf END

### h5bp/directive-only/extra-security.conf START
add_header X-Frame-Options SAMEORIGIN always;

add_header X-Content-Type-Options nosniff always;

add_header X-XSS-Protection "1; mode=block" always;

### h5bp/directive-only/extra-security.conf END
### h5bp/location/protect-system-files.conf START
location ~* /.(?!well-known/) {
deny all;
}

location ~* (?:.(?:bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op])|~)$ {
deny all;
}
### h5bp/location/protect-system-files.conf END
### h5bp/directive-only/x-ua-compatible.conf START
add_header "X-UA-Compatible" "IE=Edge";
### h5bp/directive-only/x-ua-compatible.conf END

### snippets/wp.supercache.conf START
set $supercache_file '';
set $supercache_uri $request_uri;

if ($request_method = POST) {
set $supercache_uri '';
}

if ($query_string) {
set $supercache_uri '';
}

if ($request_uri ~* "(/wp-admin/|/xmlrpc.php|/wp-(app|cron|login|register|mail).php|wp-.*.php|/feed/|index.php|wp-comments-popup.php|wp-links-opml.php|wp-locations.php|sitemap(_index)?.xml|[a-z0-9_-]+-sitemap([0-9]+)?.xml)") {
set $supercache_uri '';
}

if ($http_cookie ~* "comment_author|wordpress_[a-f0-9]+|wp-postpass|wordpress_logged_in") {
set $supercache_uri '';
}

if ($supercache_uri ~ ^(.+)$) {
set $supercache_file /$wp_content_path/cache/supercache/$http_host/$1index.html;
}

add_header X-Shit $document_root$supercache_file;
if (-f $document_root$supercache_file) {
rewrite ^(.*)$ $supercache_file break;
### snippets/wp.supercache.conf END
### snippets/wp.multisite-redirects.conf START



rewrite ^/(wp-.*.php)$ /$wp_site_path/$1 last;
rewrite ^/(wp-(admin|includes).*) /$wp_site_path/$1 last;

if (!-e $request_filename) {
rewrite /wp-admin$ $scheme://$host$uri/ permanent;
rewrite ^/[_0-9a-zA-Z-]+(/wp-.*) /$wp_site_path/$1 last;
rewrite ^/[_0-9a-zA-Z-]+(/.*.php)$ /wp$1 last;
### snippets/wp.multisite-redirects.conf END

### snippets/https-redirect.conf START
if ($scheme != "https") {
return 301 https://$host$request_uri;
}
### snippets/https-redirect.conf END

### snippets/php.simple.conf START
location / {
try_files $uri $uri/ /index.php?q=$uri&$args ;
### snippets/php.simple.conf END

location ~ .php$ {
### snippets/fastcgi-php.conf START
fastcgi_split_path_info ^(.+.php)(/.+)$;

try_files $fastcgi_script_name =404;

set $path_info $fastcgi_path_info;
fastcgi_param PATH_INFO $path_info;

fastcgi_index index.php;
### snippets/fastcgi-php.conf END
fastcgi_pass unix:/run/php/php7.0-fpm.sock ;
}



}
### memuller.template.conf END
